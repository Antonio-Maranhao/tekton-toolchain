# lab 2
This lab focuses on git integration.  

## Turn on github building

Fork the github repo if you have not already done so and perorm the steps in lab1 to create the toolchain containing the forked github repository and the pipeline service.

In the `Pipeline Service` definitions change the `Path` to lab2

First step is to open the toolchain then open the delivery pipeline, click `Configure Pipeline` and open the `Triggers` panel. Add a `Git Trigger` and specify the the git repo for your fork.

The tekton pipeline will be triggered automatically when your fork is changed.  Make a change to the repository.  In the file lab2/example.yaml change the string:

```
      args:
        - "-c"
        - "echo 01 lab2 env VAR: $VAR"
```
to
```
      args:
        - "-c"
        - "echo 02 lab2 env VAR: $VAR"
```
You can even do this in the github web site.  Just hit the pencil and start editing.

Open the `Delivery Pipeline` and in a few moments a new pipeline run will appear.  Open the log and verify the change.

## Run a shell script

To run a shell script in a task the directory of the shell script needs to be available to the task.  Notice in lab2/scripts there is an example script: `hello.sh`.

There are some handy tasks provided by the open toolchain and one of them deals with git repositories.  First open the toolchain and add a tool `GitHub`, Repository type: Existing, GitHub URL: https://github.com/open-toolchain/tekton-catalog

Borrowing heavily from this example, check it out: https://github.com/open-toolchain/tekton-catalog/blob/master/git/sample/listener-simple-clone.yaml

Before getting too deep lets look at parameters starting with tasks.  Below an input parameter `var` is declared and it has a default `VALUE`.  With just this change you can guess what will be generated by the echovar and echoevnvar task steps.
```
kind: Task
metadata:
  name: the-task
spec:
  inputs:
    params:
      - name: var
        description: var example in task
        default: VALUE
  steps:
    - name: echovar
      image: ubuntu
      command:
        - /bin/echo
      args:
        - $(inputs.params.var)
    - name: echoenvvar
      image: ubuntu
      env:
        - name: VAR
          value: $(inputs.params.var)
      command:
        - "/bin/bash"
      args:
        - "-c"
        - "echo env VAR: $VAR"
```

But how do I get parameters to the task?
Open the Delivery Pipeline, click `Configure Pipeline` and in the `Definitions` tab choose `Add`, Repository: tekton-catalog, Branch

